input {
  beats {
    port => 5045
    type => "windows"
  }
}

filter {
  if [type] == "windows" {
    mutate {
      add_field => { "log_source" => "windows" }
      add_field => { "log_type" => "system" }
    }

    if [winlog][event_id] {
      if [winlog][event_id] == 4625 {
        mutate {
          add_field => { "severity" => "high" }
          add_field => { "alert_hint" => "failed_login" }
        }
      } else if [winlog][event_id] == 4648 {
        mutate {
          add_field => { "severity" => "medium" }
          add_field => { "alert_hint" => "explicit_credentials" }
        }
      } else if [winlog][event_id] == 4720 {
        mutate {
          add_field => { "severity" => "medium" }
          add_field => { "alert_hint" => "account_created" }
        }
      } else if [winlog][event_id] == 4728 or [winlog][event_id] == 4732 {
        mutate {
          add_field => { "severity" => "medium" }
          add_field => { "alert_hint" => "group_member_added" }
        }
      } else {
        mutate { add_field => { "severity" => "info" } }
      }
    }
  }
}

output {
  kafka {
    bootstrap_servers => "kafka:9092"
    topic_id => "soc-logs"
    codec => json
  }
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "soc-logs-%{+YYYY.MM.dd}"
  }
}
