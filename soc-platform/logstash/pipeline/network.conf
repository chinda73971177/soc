input {
  tcp {
    port => 5145
    type => "network"
  }
  udp {
    port => 5145
    type => "network"
  }
}

filter {
  if [type] == "network" {
    grok {
      match => {
        "message" => [
          "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:device} %{WORD:action}: in:%{WORD:in_iface} out:%{WORD:out_iface} src=%{IP:src_ip} dst=%{IP:dst_ip} proto=%{WORD:protocol} spt=%{INT:src_port} dpt=%{INT:dst_port}",
          "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:device} %{GREEDYDATA:log_message}"
        ]
      }
    }
    mutate {
      add_field => { "log_source" => "network" }
      add_field => { "log_type" => "network" }
      convert => {
        "src_port" => "integer"
        "dst_port" => "integer"
      }
    }
  }
}

output {
  kafka {
    bootstrap_servers => "kafka:9092"
    topic_id => "soc-logs"
    codec => json
  }
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "soc-logs-%{+YYYY.MM.dd}"
  }
}
