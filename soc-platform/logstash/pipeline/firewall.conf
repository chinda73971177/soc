input {
  udp {
    port => 5140
    type => "firewall"
  }
  tcp {
    port => 5140
    type => "firewall"
  }
}

filter {
  if [type] == "firewall" {
    grok {
      match => {
        "message" => "%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME:firewall_host} %{WORD:fw_action} %{WORD:protocol} src=%{IP:src_ip} dst=%{IP:dst_ip} sport=%{INT:src_port} dport=%{INT:dst_port}"
      }
    }
    mutate {
      add_field => { "log_source" => "firewall" }
      add_field => { "log_type" => "network" }
      convert => {
        "src_port" => "integer"
        "dst_port" => "integer"
      }
    }
    if [fw_action] == "DROP" or [fw_action] == "DENY" or [fw_action] == "BLOCK" {
      mutate { add_field => { "severity" => "medium" } }
    } else {
      mutate { add_field => { "severity" => "info" } }
    }
  }
}

output {
  kafka {
    bootstrap_servers => "kafka:9092"
    topic_id => "soc-logs"
    codec => json
  }
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "soc-logs-%{+YYYY.MM.dd}"
  }
}
